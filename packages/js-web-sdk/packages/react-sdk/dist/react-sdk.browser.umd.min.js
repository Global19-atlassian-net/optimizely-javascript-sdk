!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],e):e((t=t||self).optimizelyReactSdk={},t.React)}(this,function(t,o){"use strict";var r="default"in o?o.default:o,n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function a(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var c=function(){return(c=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function i(){}var e,p=(function(t){t.exports=function(){function t(t,e,r,n,o,i){if("SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"!==i){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function e(){return t}var r={array:t.isRequired=t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e};return r.checkPropTypes=i,r.PropTypes=r}()}(e={exports:{}},e.exports),e.exports),l=function(){},u=function(t,e,r,n,o,i,a,u){if(!t){var s;if(void 0===e)s=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[r,n,o,i,a,u],p=0;(s=new Error(e.replace(/%s/g,function(){return c[p++]}))).name="Invariant Violation"}throw s.framesToPop=1,s}};function s(){var e=!1;return function(t){l(e,t),e=!0}}var f=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},h=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},d=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},b=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},y=s();var v=function(s){function c(){var t,e,r,n,o;f(this,c);for(var i=arguments.length,a=Array(i),u=0;u<i;u++)a[u]=arguments[u];return(t=e=b(this,s.call.apply(s,[this].concat(a)))).broadcast=(r=e.props.value,n=r,o=[],{getValue:function(){return n},publish:function(t){n=t,o.forEach(function(t){return t(n)})},subscribe:function(e){return o.push(e),function(){o=o.filter(function(t){return t!==e})}}}),b(e,t)}return d(c,s),c.prototype.getChildContext=function(){var t;return{broadcasts:h({},this.context.broadcasts,(t={},t[this.props.channel]=this.broadcast,t))}},c.prototype.componentWillMount=function(){y("<Broadcast> is deprecated and will be removed in the next major release. Please use createContext instead. See https://goo.gl/QAF37J for more info.")},c.prototype.componentWillReceiveProps=function(t){u(this.props.channel===t.channel,"You cannot change <Broadcast channel>"),this.props.compareValues(this.props.value,t.value)||this.broadcast.publish(t.value)},c.prototype.render=function(){return r.Children.only(this.props.children)},c}(r.Component);v.propTypes={channel:p.string.isRequired,children:p.node.isRequired,compareValues:p.func,value:p.any},v.defaultProps={compareValues:function(t,e){return t===e}},v.contextTypes={broadcasts:p.object},v.childContextTypes={broadcasts:p.object.isRequired};var m=s(),g=function(i){function a(){var t,e;f(this,a);for(var r=arguments.length,n=Array(r),o=0;o<r;o++)n[o]=arguments[o];return(t=e=b(this,i.call.apply(i,[this].concat(n)))).state={value:void 0},b(e,t)}return d(a,i),a.prototype.getBroadcast=function(){var t=(this.context.broadcasts||{})[this.props.channel];return u(this.props.quiet||t,'<Subscriber channel="%s"> must be rendered in the context of a <Broadcast channel="%s">',this.props.channel,this.props.channel),t},a.prototype.componentWillMount=function(){m("<Subscriber> is deprecated and will be removed in the next major release. Please use createContext instead. See https://goo.gl/QAF37J for more info.");var t=this.getBroadcast();t&&this.setState({value:t.getValue()})},a.prototype.componentDidMount=function(){var e=this,t=this.getBroadcast();t&&(this.unsubscribe=t.subscribe(function(t){e.setState({value:t})}))},a.prototype.componentWillUnmount=function(){this.unsubscribe&&this.unsubscribe()},a.prototype.render=function(){var t=this.props.children;return t?t(this.state.value):null},a}(r.Component);g.propTypes={channel:p.string.isRequired,children:p.func,quiet:p.bool},g.defaultProps={quiet:!1},g.contextTypes={broadcasts:p.object};var x=1;var O=function(u){var s=x++,t=function(i){function a(){var t,r;f(this,a);for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return(t=r=b(this,i.call.apply(i,[this].concat(n)))).subscribers=[],r.publish=function(e){r.subscribers.forEach(function(t){return t(e)})},r.subscribe=function(e){return r.subscribers.push(e),function(){r.subscribers=r.subscribers.filter(function(t){return t!==e})}},r.getValue=function(){return r.props.value},b(r,t)}return d(a,i),a.prototype.getChildContext=function(){var t;return{broadcasts:h({},this.context.broadcasts,(t={},t[s]={subscribe:this.subscribe,getValue:this.getValue},t))}},a.prototype.componentWillReceiveProps=function(t){this.props.value!==t.value&&this.publish(t.value)},a.prototype.render=function(){return this.props.children},a}(r.Component);t.defaultValue=u,t.propTypes={children:p.node,value:p.any},t.defaultProps={value:u},t.contextTypes={broadcasts:p.object},t.childContextTypes={broadcasts:p.object.isRequired};var e=function(i){function a(){var t,e;f(this,a);for(var r=arguments.length,n=Array(r),o=0;o<r;o++)n[o]=arguments[o];return(t=e=b(this,i.call.apply(i,[this].concat(n)))).broadcast=e.context.broadcasts&&e.context.broadcasts[s],e.state={value:e.broadcast?e.broadcast.getValue():u},b(e,t)}return d(a,i),a.prototype.componentDidMount=function(){var e=this;this.broadcast?this.unsubscribe=this.broadcast.subscribe(function(t){e.setState({value:t})}):l(this.props.quiet,"<Consumer> was rendered outside the context of its <Provider>")},a.prototype.componentWillUnmount=function(){this.unsubscribe&&this.unsubscribe()},a.prototype.render=function(){var t=this.props.children;return t?t(this.state.value):null},a}(r.Component);return e.contextTypes={broadcasts:p.object},e.propTypes={children:p.func,quiet:p.bool},e.defaultProps={quiet:!1},{Provider:t,Consumer:e}}({optimizely:null,timeout:0}),E=O.Consumer,V=O.Provider,w=E,P=V;var R=function(i){function t(t){var e=i.call(this,t)||this,r=t.optimizely,n=t.userId,o=t.userAttributes;return console.log("creating wrapper",n,o),e.sdkWrapper=function(t){var u=t.instance,r=t.userId,n=t.userAttributes;function s(t,e){return[void 0!==t?t:r,(void 0!==e?e:n)||{}]}return c({},u,{activate:function(t,e,r){return u.activate.apply(u,[t].concat(s(e,r)))},getVariation:function(t,e,r){return u.getVariation.apply(u,[t].concat(s(e,r)))},getFeatureVariables:function(t,e,r){return u.getFeatureVariables.apply(u,[t].concat(s(e,r)))},getFeatureVariableInteger:function(t,e,r,n){return u.getFeatureVariableInteger.apply(u,[t,e].concat(s(r,n)))},getFeatureVariableString:function(t,e,r,n){return u.getFeatureVariableString.apply(u,[t,e].concat(s(r,n)))},getFeatureVariableBoolean:function(t,e,r,n){return u.getFeatureVariableBoolean.apply(u,[t,e].concat(s(r,n)))},getFeatureVariableDouble:function(t,e,r,n){return u.getFeatureVariableDouble.apply(u,[t,e].concat(s(r,n)))},isFeatureEnabled:function(t,e,r){return u.isFeatureEnabled.apply(u,[t].concat(s(e,r)))},track:function(t,e,r,n){void 0!==e&&"string"!=typeof e&&(n=e,r=e=void 0);var o=s(e,r),i=o[0],a=o[1];return u.track(t,i,a,n)}})}({instance:r,userId:n,userAttributes:o}),e}return a(t,i),t.prototype.render=function(){var t=this.props,e=t.children,r=t.timeout,n={optimizely:this.sdkWrapper,timeout:r};return o.createElement(P,{value:n},e)},t}(o.Component);function C(r){return function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.render=function(){var e=this;return o.createElement(w,null,function(t){return o.createElement(r,c({},e.props,{optimizely:t.optimizely,optimizelyReadyTimeout:t.timeout}))})},e}(o.Component)}var T=C(function(r){function t(t){var e=r.call(this,t)||this;return e.state={canRender:!1,isEnabled:!1,variables:{}},e}return a(t,r),t.prototype.componentDidMount=function(){var r=this,t=this.props,n=t.feature,o=t.optimizely,e=t.optimizelyReadyTimeout;if(null===o)throw new Error("optimizely prop must be supplied");o.onReady({timeout:e}).then(function(){var t=o.isFeatureEnabled(n),e=o.getFeatureVariables(n);r.setState({canRender:!0,isEnabled:t,variables:e})})},t.prototype.render=function(){var t=this.props.children,e=this.state,r=e.isEnabled,n=e.variables;return e.canRender?t(r,n):null},t}(o.Component)),_=C(function(r){function t(t){var e=r.call(this,t)||this;return e.state={canRender:!1,variation:null},e}return a(t,r),t.prototype.componentDidMount=function(){var e=this,t=this.props,r=t.experiment,n=t.optimizely,o=t.optimizelyReadyTimeout;if(!n)throw new Error("optimizely prop must be supplied");n.onReady({timeout:o}).then(function(){var t=n.activate(r);e.setState({canRender:!0,variation:t})})},t.prototype.render=function(){var t=this.props.children,e=this.state,r=e.variation;if(!e.canRender)return null;if(null!=t&&"function"==typeof t)return t(r);var n=null;return o.Children.forEach(this.props.children,function(t){!n&&o.isValidElement(t)&&(t.props.variation?r===t.props.variation&&(n=t):t.props.default&&(n=t))}),n?o.cloneElement(n,{variation:r}):null},t}(o.Component)),j=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.render=function(){return this.props.children},e}(o.Component);t.OptimizelyProvider=R,t.OptimizelyFeature=T,t.withOptimizely=C,t.OptimizelyExperiment=_,t.OptimizelyVariation=j,Object.defineProperty(t,"__esModule",{value:!0})});
